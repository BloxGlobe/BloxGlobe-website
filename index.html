<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BloxGlobe Dashboard</title>

  <!-- Tailwind output MUST load first -->
  <link rel="stylesheet" href="dist/output.css">

  <!-- Custom global styles -->
  <link rel="stylesheet" href="src/assets/styles/global.css" />
</head>

<body class="bg-gray-900 text-white">

  <div class="flex h-screen w-full overflow-hidden">

    <!-- Sidebar -->
    <aside class="sidebar w-64 bg-gray-800 p-5 flex flex-col gap-3 shrink-0">

      <h1 class="text-xl font-bold mb-4">Dashboard</h1>

      <button class="nav-btn" data-page="home">Home</button>
      <button class="nav-btn" data-page="experience">Experiences</button>
      <button class="nav-btn" data-page="ugc">UGC Clothing</button>

      <div class="h-[1px] bg-gray-700 my-2 opacity-40"></div>

      <button class="nav-btn" data-page="feedback">Forums</button>

      <div class="mt-3 flex items-center gap-2 text-sm opacity-60">
        <a href="#" class="hover:opacity-100 transition">Docs</a>
        <span>•</span>
        <a href="#" class="hover:opacity-100 transition">Support</a>
      </div>

      <button class="nav-btn mt-2" data-page="site">Game Updates</button>
      <button class="nav-btn" data-page="setting">Settings</button>

    </aside>

    <!-- Main Content -->
    <main id="app" class="main-content flex-1 flex flex-col overflow-y-auto">

      <div id="page-content" class="p-6">
        Loading...
      </div>

      <footer class="py-3 text-left opacity-60 text-sm border-t border-gray-700 pl-6 w-full">
        © <span id="year"></span> BloxGlobe — All rights reserved.
      </footer>

    </main>

  </div>


<!-- PAGE LOADER -->
<script type="module">
  const app = document.getElementById('page-content');

  async function loadPage(page){
    try{
      const res = await fetch(`src/pages/${page}.html`);
      if(!res.ok) throw new Error();
      const html = await res.text();
      app.innerHTML = html;

      document.querySelectorAll('.nav-btn')
        .forEach(btn => btn.classList.remove('bg-gray-700'));

      const active = document.querySelector(`.nav-btn[data-page="${page}"]`);
      if(active) active.classList.add('bg-gray-700');

      history.replaceState({page}, '', `#${page}`);

    } catch {
      const res = await fetch(`src/pages/404.html`);
      app.innerHTML = await res.text();
    }
  }

  document.querySelectorAll('.nav-btn').forEach(btn =>
    btn.addEventListener('click', () => loadPage(btn.dataset.page))
  );

  const initial = location.hash ? location.hash.slice(1) : 'home';
  loadPage(initial);

  window.addEventListener('popstate', (e)=>{
    const page = (e.state?.page) || location.hash.slice(1) || 'home';
    loadPage(page);
  });

  document.getElementById("year").textContent = new Date().getFullYear();
</script>


<!-- SECURITY PROMPT -->
<script type="module">
  import { openSecurityPrompt } from "./packages/Oauth/securityPrompt.js";

  document.addEventListener("click", (e) => {
    const target = e.target;

    if (target && target.id === "postUpdateBtn") {
      openSecurityPrompt(() => {
        const input = document.getElementById("updateInput");
        const log = document.getElementById("changelog");

        if (!input.value.trim()) return;

        log.innerHTML = `<div class="mb-2">• ${input.value}</div>` + log.innerHTML;
        input.value = "";
      });
    }
  });
</script>

<!-- Optional routing overrides -->
<script src="router.js"></script>

</body>
</html>
